<div class="main-container">
  <!-- Page Header -->
  <div class="page-header">
    <h2>ğŸ“‹ Gestion des Rapports</h2>
    <p class="subtitle">Consultez et gÃ©rez tous les rapports d'analyse</p>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <span class="icon">âœ“</span>
    <span>{{ successMessage }}</span>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    <span class="icon">âš ï¸</span>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Filters Card -->
  <div class="card filter-card">
    <div class="card-content">
      <h3>ğŸ” Filtres de recherche</h3>
      
      <form [formGroup]="filterForm" (ngSubmit)="onFilterSubmit()">
        <div class="filter-grid">
          <!-- Search Input -->
          <div class="form-group">
            <label for="search" class="form-label">Rechercher</label>
            <input 
              type="text" 
              id="search" 
              class="form-control" 
              formControlName="search"
              placeholder="Rechercher par valeur..."
            >
          </div>

          <!-- Status Filter -->
          <div class="form-group">
            <label for="status" class="form-label">Statut</label>
            <select id="status" class="form-control" formControlName="status">
              <option value="">Tous les statuts</option>
              <option value="pending">En attente</option>
              <option value="pending_review">En attente de rÃ©vision</option>
              <option value="in_progress">En cours</option>
              <option value="completed">TerminÃ©</option>
              <option value="archived">ArchivÃ©</option>
              <option value="false_positive">Faux positif</option>
            </select>
          </div>

          <!-- Severity Filter -->
          <div class="form-group">
            <label for="severity" class="form-label">SÃ©vÃ©ritÃ©</label>
            <select id="severity" class="form-control" formControlName="severity">
              <option value="">Toutes les sÃ©vÃ©ritÃ©s</option>
              <option value="informational">Informatif</option>
              <option value="low">Faible</option>
              <option value="medium">Moyen</option>
              <option value="high">Ã‰levÃ©</option>
              <option value="critical">Critique</option>
            </select>
          </div>

          <!-- Input Type Filter -->
          <div class="form-group">
            <label for="input_type" class="form-label">Type d'entrÃ©e</label>
            <select id="input_type" class="form-control" formControlName="input_type">
              <option value="">Tous les types</option>
              <option value="url">URL</option>
              <option value="ip">Adresse IP</option>
              <option value="domain">Domaine</option>
              <option value="email">Email</option>
              <option value="hash">Hash</option>
              <option value="file">Fichier</option>
            </select>
          </div>
        </div>

        <div class="filter-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="isFiltering"
          >
            <span *ngIf="!isFiltering">ğŸ” Appliquer les filtres</span>
            <span *ngIf="isFiltering">
              <span class="spinner"></span> Filtrage...
            </span>
          </button>
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="onClearFilters()"
          >
            ğŸ”„ RÃ©initialiser
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Statistics Summary -->
  <div class="stats-summary" *ngIf="!loading">
    <div class="stat-item">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <div class="stat-value">{{ totalCount }}</div>
        <div class="stat-label">Total des rapports</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">ğŸ“„</div>
      <div class="stat-content">
        <div class="stat-value">{{ reports.length }}</div>
        <div class="stat-label">AffichÃ©s</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">ğŸ“‘</div>
      <div class="stat-content">
        <div class="stat-value">{{ currentPage }}/{{ totalPages }}</div>
        <div class="stat-label">Page</div>
      </div>
    </div>
  </div>

  <!-- Reports Table Card -->
  <div class="card">
    <div class="card-content">
      <h3>ğŸ“‹ Liste des rapports</h3>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-overlay">
        <div class="spinner-large"></div>
        <p>Chargement des rapports...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && reports.length === 0" class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <h3>Aucun rapport disponible</h3>
        <p>Il n'y a actuellement aucun rapport Ã  afficher.</p>
      </div>

      <!-- Table -->
      <div *ngIf="!loading && reports.length > 0" class="table-wrapper">
        <div class="table-responsive">
          <table class="reports-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Valeur d'entrÃ©e</th>
                <th>Type</th>
                <th>SÃ©vÃ©ritÃ©</th>
                <th>Score</th>
                <th>Statut</th>
                <th>Analyste</th>
                <th>AssignÃ© Ã </th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let report of reports; trackBy: trackByReportId" class="table-row">
                <!-- ID -->
                <td class="text-center">
                  <span class="id-badge">#{{ report.id.slice(0, 8) }}</span>
                </td>

                <!-- Input Value -->
                <td class="input-value" [title]="report.input_value">
                  <div class="truncate">
                    {{ report.input_value }}
                  </div>
                </td>

                <!-- Input Type -->
                <td>
                  <span class="type-badge">
                    {{ getInputTypeLabel(report.input_type) }}
                  </span>
                </td>

                <!-- Severity -->
                <td>
                  <span class="badge" [ngClass]="getSeverityClass(report.severity)">
                    {{ getSeverityLabel(report.severity) }}
                  </span>
                </td>

                <!-- Threat Score -->
                <td class="text-center">
                  <div class="score-badge" [ngClass]="getSeverityClass(report.severity)">
                    {{ report.threat_score | number:'1.0-0' }}
                  </div>
                </td>

                <!-- Status -->
                <td>
                  <span class="badge" [ngClass]="getStatusClass(report.status)">
                    {{ getStatusLabel(report.status) }}
                  </span>
                </td>

                <!-- Analyst -->
                <td>
                  <div class="user-info">
                    <span class="user-icon">ğŸ‘¤</span>
                    <span>{{ report.analyst.username }}</span>
                  </div>
                </td>

                <!-- Assigned To -->
                <td>
                  <div class="user-info">
                    <span class="user-icon">ğŸ¯</span>
                    <span>{{ report.assigned_to.username }}</span>
                  </div>
                </td>

                <!-- Created Date -->
                <td class="date-column">
                  <span class="date-text">{{ formatDate(report.created_at) }}</span>
                </td>

                <!-- Actions -->
                <td>
                  <div class="action-buttons">
                    <!-- View Button -->
                    <button 
                      class="btn-action btn-view" 
                      (click)="viewReport(report.id)"
                      title="Voir les dÃ©tails"
                    >
                      <span class="icon">ğŸ‘ï¸</span>
                    </button>

                    <!-- Download PDF (Analyst) -->
                    <button 
                      *ngIf="isAnalyst"
                      class="btn-action btn-download" 
                      (click)="downloadPdf(report.id)"
                      title="TÃ©lÃ©charger PDF"
                    >
                      <span class="icon">ğŸ“¥</span>
                    </button>

                    <!-- Create Task (Analyst) -->
                    <button 
                      *ngIf="isAnalyst"
                      class="btn-action btn-task" 
                      (click)="createTask(report)"
                      title="CrÃ©er une tÃ¢che"
                    >
                      <span class="icon">â•</span>
                    </button>

                    <!-- Send to Admin (Analyst) -->
                    <button 
                      *ngIf="isAnalyst"
                      class="btn-action btn-send" 
                      (click)="sendToAdmin(report)"
                      title="Envoyer Ã  l'admin"
                    >
                      <span class="icon">ğŸ“¤</span>
                    </button>

                    <!-- Edit Button (Admin) -->
                    <button 
                      *ngIf="isAdmin"
                      class="btn-action btn-edit" 
                      (click)="editReport(report.id)"
                      title="Modifier"
                    >
                      <span class="icon">âœï¸</span>
                    </button>

                    <!-- Delete Button (Admin) -->
                    <button 
                      *ngIf="isAdmin"
                      class="btn-action btn-delete" 
                      (click)="deleteReport(report.id)"
                      title="Supprimer"
                    >
                      <span class="icon">ğŸ—‘ï¸</span>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Pagination -->
      <div *ngIf="!loading && reports.length > 0 && totalPages > 1" class="pagination-container">
        <div class="pagination">
          <!-- Previous Button -->
          <button 
            class="pagination-btn"
            [disabled]="currentPage === 1"
            (click)="onPageChange(currentPage - 1)"
          >
            â† PrÃ©cÃ©dent
          </button>

          <!-- First Page -->
          <button 
            class="pagination-number"
            [class.active]="currentPage === 1"
            (click)="onPageChange(1)"
          >
            1
          </button>

          <!-- Ellipsis before -->
          <span *ngIf="currentPage > 4" class="pagination-ellipsis">...</span>

          <!-- Page Numbers -->
          <button 
            *ngFor="let page of getPaginationRange()"
            class="pagination-number"
            [class.active]="currentPage === page"
            (click)="onPageChange(page)"
          >
            {{ page }}
          </button>

          <!-- Ellipsis after -->
          <span *ngIf="currentPage < totalPages - 3" class="pagination-ellipsis">...</span>

          <!-- Last Page -->
          <button 
            *ngIf="totalPages > 1"
            class="pagination-number"
            [class.active]="currentPage === totalPages"
            (click)="onPageChange(totalPages)"
          >
            {{ totalPages }}
          </button>

          <!-- Next Button -->
          <button 
            class="pagination-btn"
            [disabled]="currentPage === totalPages"
            (click)="onPageChange(currentPage + 1)"
          >
            Suivant â†’
          </button>
        </div>

        <div class="pagination-info">
          Affichage de {{ (currentPage - 1) * pageSize + 1 }} Ã  {{ Math.min(currentPage * pageSize, totalCount) }} sur {{ totalCount }} rapports
        </div>
      </div>
    </div>
  </div>
</div>