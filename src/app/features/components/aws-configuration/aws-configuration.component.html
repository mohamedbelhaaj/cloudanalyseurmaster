<div class="config-container">
  
  <header class="page-header">
    <div class="header-content">
      <h1>AWS Configurations</h1>
      <p class="subtitle">Manage credentials and resources</p>
    </div>
    <button class="btn btn-primary" (click)="toggleForm()">
      {{ showForm ? 'Cancel' : '+ Add Configuration' }}
    </button>
  </header>

  <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>
  <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>

  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <p>Processing...</p>
  </div>

  <div class="form-card" *ngIf="showForm">
    <h2>{{ editMode ? 'Edit Configuration' : 'New Configuration' }}</h2>
    
    <form [formGroup]="configForm" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        
        <div class="form-group">
          <label>Configuration Name</label>
          <input formControlName="name" placeholder="e.g. Production Env">
        </div>

        <div class="form-group">
          <label>Region</label>
          <select formControlName="aws_region">
            <option value="us-east-1">US East (N. Virginia)</option>
            <option value="us-east-2">US East (Ohio)</option>
            <option value="eu-west-1">EU (Ireland)</option>
            <option value="eu-central-1">EU (Frankfurt)</option>
          </select>
        </div>

        <div class="form-group full-width">
          <label>Access Key ID</label>
          <input formControlName="aws_access_key" class="mono" placeholder="AKIA...">
        </div>

        <div class="form-group full-width">
          <label>Secret Access Key</label>
          <input type="password" formControlName="aws_secret_key" class="mono">
        </div>

        <div class="form-group full-width">
          <label>Session Token (Optional)</label>
          <textarea formControlName="aws_session_token" rows="3" class="mono"></textarea>
        </div>

        <div class="form-group checkbox-group">
            <label>
                <input type="checkbox" formControlName="is_active"> Set as Active
            </label>
        </div>

      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="toggleForm()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="loading">
          {{ editMode ? 'Update & Redirect' : 'Create & Redirect' }}
        </button>
      </div>
    </form>
  </div>

  <div class="grid-list" *ngIf="!showForm">
    <div class="card" *ngFor="let config of configurations" [class.active-card]="config.is_active">
      <div class="card-header">
        <h3>{{ config.name }}</h3>
        <span class="badge" *ngIf="config.is_active">ACTIVE</span>
      </div>
      <div class="card-body">
        <p><strong>Region:</strong> {{ config.aws_region }}</p>
        <p><strong>Key:</strong> {{ config.aws_access_key | slice:0:10 }}...</p>
      </div>
      <div class="card-actions">
        <button class="btn btn-sm" (click)="testCredentials(config.id!)" [disabled]="testing">
            {{ testing ? 'Testing...' : 'Test Connection' }}
        </button>
        <button class="btn btn-sm" (click)="editConfiguration(config)">Edit</button>
        <button class="btn btn-sm btn-danger" (click)="deleteConfiguration(config.id!)">Delete</button>
      </div>
    </div>
  </div>

</div>