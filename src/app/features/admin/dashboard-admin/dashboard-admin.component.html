<!-- admin-dashboard.component.html -->
<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class="fas fa-shield-alt"></i>
        Threat Intelligence Dashboard
      </h1>
      <div class="header-actions">
        <span class="last-updated">
          Last updated: {{ lastUpdated | date:'short' }}
        </span>
        <button 
          class="btn btn-icon" 
          [class.active]="autoRefresh"
          (click)="toggleAutoRefresh()"
          title="Toggle auto-refresh">
          <i class="fas fa-sync-alt"></i>
        </button>
        <button 
          class="btn btn-primary" 
          (click)="refresh()"
          [disabled]="loading">
          <i class="fas fa-refresh"></i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && !dashboardStats" class="loading-container">
    <div class="spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-error">
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="dashboardStats && !loading" class="dashboard-content">
    
    <!-- AWS Status Banner -->
    <div *ngIf="awsStatus" class="aws-status-banner" [ngClass]="getAWSStatusClass()">
      <div class="aws-status-content">
        <div class="aws-status-icon">
          <i class="fab fa-aws"></i>
        </div>
        <div class="aws-status-info">
          <h3>AWS Infrastructure Status</h3>
          <div class="aws-details">
            <span><strong>Region:</strong> {{ awsStatus.region }}</span>
            <span><strong>VPC Status:</strong> {{ awsStatus.vpc_status | uppercase }}</span>
            <span><strong>Active Configs:</strong> {{ awsStatus.active_configurations }}</span>
            <span><strong>Security Groups:</strong>   {{ awsStatus.security_groups.length || 0 }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Overview Cards -->
    <div class="stats-grid">
      <div class="stat-card card-primary">
        <div class="stat-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="stat-content">
          <h3>Total Reports</h3>
          <p class="stat-number">{{ dashboardStats.overview.total_reports }}</p>
        </div>
      </div>

      <div class="stat-card card-warning">
        <div class="stat-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
          <h3>Pending</h3>
          <p class="stat-number">{{ dashboardStats.overview.pending_reports }}</p>
        </div>
      </div>

      <div class="stat-card card-danger">
        <div class="stat-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="stat-content">
          <h3>Critical</h3>
          <p class="stat-number">{{ dashboardStats.overview.critical_reports }}</p>
        </div>
      </div>

      <div class="stat-card card-success">
        <div class="stat-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
          <h3>Mitigated</h3>
          <p class="stat-number">{{ dashboardStats.overview.mitigated_reports }}</p>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-grid">
      <div class="chart-card">
        <canvas id="severityChart"></canvas>
      </div>

      <div class="chart-card">
        <canvas id="statusChart"></canvas>
      </div>

      <div class="chart-card chart-wide">
        <canvas id="trendsChart"></canvas>
      </div>
    </div>

    <!-- Tasks and Mitigations -->
    <div class="info-grid">
      <!-- Tasks Overview -->
      <div class="info-card">
        <h3 class="card-title">
          <i class="fas fa-tasks"></i>
          Tasks Overview
        </h3>
        <div class="task-list">
          <div class="task-item">
            <span class="task-label">Open</span>
            <span class="task-badge badge-warning">{{ dashboardStats.tasks.open }}</span>
          </div>
          <div class="task-item">
            <span class="task-label">In Progress</span>
            <span class="task-badge badge-info">{{ dashboardStats.tasks.in_progress }}</span>
          </div>
          <div class="task-item">
            <span class="task-label">Completed</span>
            <span class="task-badge badge-success">{{ dashboardStats.tasks.completed }}</span>
          </div>
          <div class="task-item urgent">
            <span class="task-label">
              <i class="fas fa-fire"></i> Urgent
            </span>
            <span class="task-badge badge-critical">{{ dashboardStats.tasks.urgent }}</span>
          </div>
        </div>
      </div>

      <!-- Mitigations Overview -->
      <div class="info-card">
        <h3 class="card-title">
          <i class="fas fa-shield"></i>
          Mitigation Actions
        </h3>
        <div class="task-list">
          <div class="task-item">
            <span class="task-label">Pending</span>
            <span class="task-badge badge-warning">{{ dashboardStats.mitigations.pending }}</span>
          </div>
          <div class="task-item">
            <span class="task-label">Completed</span>
            <span class="task-badge badge-success">{{ dashboardStats.mitigations.completed }}</span>
          </div>
          <div class="task-item">
            <span class="task-label">Failed</span>
            <span class="task-badge badge-danger">{{ dashboardStats.mitigations.failed }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Critical Alerts -->
    <div class="alerts-section">
      <h3 class="section-title">
        <i class="fas fa-bell"></i>
        Recent Critical Alerts
      </h3>
      <div class="alerts-container">
        <div *ngIf="dashboardStats.recent_critical.length === 0" class="no-data">
          <i class="fas fa-check-circle"></i>
          <p>No critical alerts at this time</p>
        </div>
        
        <div 
          *ngFor="let alert of dashboardStats.recent_critical" 
          class="alert-item">
          <div class="alert-header">
            <span [class]="getSeverityBadgeClass(alert.severity)">
              {{ alert.severity | uppercase }}
            </span>
            <span class="alert-type">{{ alert.input_type }}</span>
            <span class="alert-time">{{ alert.created_at | date:'short' }}</span>
          </div>
          <div class="alert-body">
            <p class="alert-value">
              <i class="fas fa-fingerprint"></i>
              {{ alert.input_value }}
            </p>
            <p *ngIf="alert.threat_score" class="alert-score">
              Threat Score: <strong>{{ alert.threat_score }}/100</strong>
            </p>
          </div>
          <div class="alert-footer">
            <span [class]="getStatusBadgeClass(alert.status)">
              {{ alert.status | uppercase }}
            </span>
            <span *ngIf="alert.assigned_to" class="assigned-to">
              <i class="fas fa-user"></i>
              {{ alert.assigned_to.username }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Threats -->
    <div class="threats-section">
      <h3 class="section-title">
        <i class="fas fa-list-ol"></i>
        Top Threat Indicators
      </h3>
      <div class="table-container">
        <table class="threats-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Indicator</th>
              <th>Type</th>
              <th>Severity</th>
              <th>Count</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let threat of dashboardStats.top_threats; let i = index">
              <td>{{ i + 1 }}</td>
              <td class="threat-value">{{ threat.input_value }}</td>
              <td>
                <span class="badge badge-secondary">{{ threat.input_type }}</span>
              </td>
              <td>
                <span [class]="getSeverityBadgeClass(threat.severity)">
                  {{ threat.severity }}
                </span>
              </td>
              <td><strong>{{ threat.count }}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>